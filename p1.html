<!DOCTYPE html>
<html>
<head>
    <title>WS Touch Game</title>
    <style>
        body { margin: 0; background: #222; color: white; font-family: sans-serif; overflow: hidden; display: flex; flex-direction: column; align-items: center; }
        canvas { background: #333; border: 2px solid #555; margin-top: 10px; max-width: 95vw; }
        
        /* D-Pad Styling */
        .controls { display: grid; grid-template-areas: ". up ." "left . right" ". down ."; gap: 10px; margin-top: 20px; }
        .btn { width: 60px; height: 60px; background: #444; border: 2px solid #888; color: white; font-size: 24px; border-radius: 10px; display: flex; align-items: center; justify-content: center; cursor: pointer; user-select: none; -webkit-user-select: none; }
        .btn:active { background: #666; transform: scale(0.95); }
        .up { grid-area: up; } .left { grid-area: left; } .right { grid-area: right; } .down { grid-area: down; }
    </style>
</head>
<body>
    <div id="status">Connecting...</div>
    <canvas id="gameCanvas" width="500" height="300"></canvas>

    <!-- On-screen Navigation -->
    <div class="controls">
        <div class="btn up" id="ctrl-up">▲</div>
        <div class="btn left" id="ctrl-left">◀</div>
        <div class="btn right" id="ctrl-right">▶</div>
        <div class="btn down" id="ctrl-down">▼</div>
    </div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const status = document.getElementById('status');

    let player = { x: 235, y: 135 };
    let ghost = { x: 235, y: 135 };
    const speed = 8;
    const keys = {};

    // WebSocket Setup
    const socket = new WebSocket('wss://ws.ifelse.io/');
    socket.onopen = () => { status.innerText = "● Connected"; status.style.color = "lime"; };
    socket.onmessage = (e) => { 
        try { const data = JSON.parse(e.data); ghost.x = data.x; ghost.y = data.y; } catch(err){}
    };

    // Movement Logic
    function move(dx, dy) {
        player.x += dx;
        player.y += dy;
        // Keep within bounds
        player.x = Math.max(0, Math.min(canvas.width - 30, player.x));
        player.y = Math.max(0, Math.min(canvas.height - 30, player.y));
        
        if (socket.readyState === WebSocket.OPEN) {
            socket.send(JSON.stringify({ x: player.x, y: player.y }));
        }
    }

    // Button Listeners
    document.getElementById('ctrl-up').onmousedown = () => move(0, -speed);
    document.getElementById('ctrl-down').onmousedown = () => move(0, speed);
    document.getElementById('ctrl-left').onmousedown = () => move(-speed, 0);
    document.getElementById('ctrl-right').onmousedown = () => move(speed, 0);
    
    // Keyboard Fallback
    window.onkeydown = (e) => {
        if(e.key === "ArrowUp") move(0, -speed);
        if(e.key === "ArrowDown") move(0, speed);
        if(e.key === "ArrowLeft") move(-speed, 0);
        if(e.key === "ArrowRight") move(speed, 0);
    };

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        // Draw Ghost (Echo)
        ctx.fillStyle = 'deepskyblue'; ctx.globalAlpha = 0.4;
        ctx.fillRect(ghost.x, ghost.y, 30, 30);
        // Draw Player
        ctx.fillStyle = 'red'; ctx.globalAlpha = 1.0;
        ctx.fillRect(player.x, player.y, 30, 30);
        requestAnimationFrame(draw);
    }
    draw();
</script>
</body>
</html>
